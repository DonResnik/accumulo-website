<!DOCTYPE html>
<html lang="en">
<head>
<!--
    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet" integrity="sha384-awusxf8AUojygHf2+joICySzB780jVvQaVCAt1clU3QsyAitLGul28Qxb2r1e5g+" crossorigin="anonymous">
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs/jq-2.2.3/dt-1.10.12/datatables.min.css">
<link href="/css/accumulo.css" rel="stylesheet" type="text/css">

<title>Apache Accumulo 1.9.3</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/bs/jq-2.2.3/dt-1.10.12/datatables.min.js"></script>
<script>
  // show location of canonical site if not currently on the canonical site
  $(function() {
    var host = window.location.host;
    if (typeof host !== 'undefined' && host !== 'accumulo.apache.org') {
      $('#non-canonical').show();
    }
  });

  $(function() {
    // decorate section headers with anchors
    return $("h2, h3, h4, h5, h6").each(function(i, el) {
      var $el, icon, id;
      $el = $(el);
      id = $el.attr('id');
      icon = '<i class="fa fa-link"></i>';
      if (id) {
        return $el.append($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
      }
    });
  });

  // fix sidebar width in documentation
  $(function() {
    var $affixElement = $('div[data-spy="affix"]');
    $affixElement.width($affixElement.parent().width());
  });
</script>

</head>
<body style="padding-top: 100px">

  <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-items">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/"><img id="nav-logo" alt="Apache Accumulo" class="img-responsive" src="/images/accumulo-logo.png" width="200"
        /></a>
    </div>
    <div class="collapse navbar-collapse" id="navbar-items">
      <ul class="nav navbar-nav">
        <li class="nav-link"><a href="/downloads">Download</a></li>
        <li class="nav-link"><a href="/tour">Tour</a></li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">Releases<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/release/accumulo-2.0.0-alpha-2/">2.0.0-alpha-2 (Preview Release)</a></li>
            <li><a href="/release/accumulo-1.9.2/">1.9.2 (Latest)</a></li>
            <li><a href="/release/">Archive</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">Documentation<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/docs/2.x/getting-started/quickstart">User Manual (2.x)</a></li>
            <li><a href="/quickstart-1.x">Quickstart (1.x)</a></li>
            <li><a href="/1.9/accumulo_user_manual.html">User Manual (1.9)</a></li>
            <li><a href="/1.9/apidocs">Javadocs (1.9)</a></li>
            <li><a href="/external-docs">External Docs</a></li>
            <li><a href="/docs-archive/">Archive</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">Community<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/contact-us">Contact Us</a></li>
            <li><a href="/how-to-contribute">How To Contribute</a></li>
            <li><a href="/people">People</a></li>
            <li><a href="/related-projects">Related Projects</a></li>
          </ul>
        </li>
        <li class="nav-link"><a href="/search">Search</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#"><img alt="Apache Software Foundation" src="https://www.apache.org/foundation/press/kit/feather.svg" width="15"/><span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="https://www.apache.org">Apache Homepage <i class="fa fa-external-link"></i></a></li>
            <li><a href="https://www.apache.org/licenses/">License <i class="fa fa-external-link"></i></a></li>
            <li><a href="https://www.apache.org/foundation/sponsorship">Sponsorship <i class="fa fa-external-link"></i></a></li>
            <li><a href="https://www.apache.org/security">Security <i class="fa fa-external-link"></i></a></li>
            <li><a href="https://www.apache.org/foundation/thanks">Thanks <i class="fa fa-external-link"></i></a></li>
            <li><a href="https://www.apache.org/foundation/policies/conduct">Code of Conduct <i class="fa fa-external-link"></i></a></li>
            <li><a href="https://www.apache.org/events/current-event.html">Current Event <i class="fa fa-external-link"></i></a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>


  <div class="container">
    <div class="row">
      <div class="col-md-12">

        <div id="non-canonical" style="display: none; background-color: #F0E68C; padding-left: 1em;">
          Visit the official site at: <a href="https://accumulo.apache.org">https://accumulo.apache.org</a>
        </div>
        <div id="content">
          
          <h1 class="title">Apache Accumulo 1.9.3</h1>
          
          <p>18 Jul 2018</p>


<div class="alert alert-info" style="margin-bottom: 0px;" role="alert">
  <p>These are <strong>draft</strong> release notes for a future release of Accumulo!</p>
  <p>Please view <a class="alert-link" href="/release/accumulo-2.0.0-alpha-2/">the latest release notes</a>.</p>
</div>






<p>Apache Accumulo 1.9.3 contains bug fixes for Write Ahead Logs and compaction.
Users of any previous version of 1.8 or 1.9 are encouraged to upgrade
<del>immediately or specify recommended timeline</del>.</p>

<ul>
  <li><a href="/1.9/accumulo_user_manual.html">User Manual</a> - In-depth developer and administrator documentation</li>
  <li><a href="/1.9/apidocs/">Javadocs</a> - Accumulo 1.9 API</li>
  <li><a href="/1.9/examples/">Examples</a> - Code with corresponding readme files that give step by
step instructions for running example code</li>
</ul>

<h2 id="notable-changes">Notable Changes</h2>

<h3 id="multiple-fixes-for-write-ahead-logs">Multiple Fixes for Write Ahead Logs</h3>

<p>This release fixes a number of issues with Write Ahead Logs that slow or prevent recovery 
and in some cases lead to data loss. The fixes reduce the number of WALS that need to be 
referenced by a tserver, improve error handing of WAL issues, and improve WAL clean up processes.</p>

<ul>
  <li>
    <p>Eliminates a race condition that could result in data loss during recovery. 
In cases where the GC deletes unreferenced WAL files as the master is simultaneously 
attempting to create the list of WALs necessary for recovery, the master will skip 
files that should be used in the recovery, resulting in data loss. Fixed in <a href="https://github.com/apache/accumulo/issues/866">#866</a>.</p>
  </li>
  <li>
    <p>If the metadata table has references to a non-existent WAL file, operations 
for that table will hang. This occurs when files published to zookeeper have existing 
references but subsequent failures have occurred in the WAL files, or if a tserver 
removes the file.  Reported in <a href="https://github.com/apache/accumulo/issues/949">#949</a> and fixed in <a href="https://github.com/apache/accumulo/issues/1057">#1005</a>.</p>
  </li>
  <li>
    <p>tserver failures could result in the creation of many files that are unreferenced and 
never written to, resulting in files with a header but no data. Recovery tries to 
handle these as “empty” files which slows the recovery process. This was fixed in <a href="https://github.com/apache/accumulo/issues/845">#823</a>.</p>
  </li>
  <li>
    <p>When the number of WALs referenced by a tserver exceeds a threshold, the tserver will 
flush and minor compact the oldest log to limit the number of wal references needed by 
that tserver. This reduces the number of WALs referenced by many tservers and speeds 
recovery by reducing the number of WALs needed during recovery.  Addressed by <a href="https://github.com/apache/accumulo/issues/860">#854</a>.</p>
  </li>
  <li>
    <p>During tablet recovery, filter out logs that do not define the tablet. <a href="https://github.com/apache/accumulo/issues/881">#881</a></p>
  </li>
  <li>
    <p>If a tserver fails sorting, a marker file is written to the recovery directory. 
The presence of this marker prevents any subsequent attempts at recovery from succeeding. 
Fixed by modifying the WAL RecoveryLogReader to handle failed file markers in <a href="https://github.com/apache/accumulo/issues/1048">#961</a>.</p>
  </li>
  <li>
    <p>Use UnsynchronizedBuffer for optimized writeV methods (writeVLong abd writeVInt) 
in Mutations so that only one write call is necessary to the underlying outputstream. 
This was mainly done as an attempt to improve WAL performance. It “should” help 
performance of mutations overall since the Hadoop WriteableUtils method can make 
multiple write calls per long. <a href="https://github.com/apache/accumulo/issues/669">#669</a></p>
  </li>
</ul>

<h3 id="multiple-fixes-for-compaction-issues">Multiple Fixes for Compaction Issues</h3>

<ul>
  <li>
    <p>Stop locking during compaction.  Compactions were acquiring the tablet lock between each 
key value. This created unnecessary contention with other operations like scan and 
bulk imports.  For <a href="https://github.com/apache/accumulo/issues/1031">#1031</a> the the synchronization was removed by <a href="https://github.com/apache/accumulo/issues/1032">#1032</a>.</p>
  </li>
  <li>
    <p>Only re-queue compaction when there is activity. <a href="https://github.com/apache/accumulo/issues/759">#759</a></p>
  </li>
</ul>

<h3 id="fix-arrayoutofbounds-error-when-new-files-are-created-affects-all-previous-versions">Fix ArrayOutOfBounds error when new files are created (affects all previous versions)</h3>

<p>Accumulo maintains a 1-up counter to keep file names and other identifiers
unique. This counter is padded with 0 characters when used in file names. If
the counter becomes sufficiently large, the padding code in versions prior to
1.9.3 causes an out of bounds error.</p>

<p>Most users will not be affected by this bug, since it requires the counter to
be very large before the error would be seen. Situations which might cause the
counter to get very large include: having a very old Accumulo cluster that has
been running for many years, having a very large cluster, having a cluster that
writes many files very quickly for long periods of time, having altered the
current value of the counter in ZooKeeper, or if you experience a bug which
causes the counter value to skip ahead very rapidly.</p>

<p>If you wish to check to see if you are at risk of being impacted by this bug,
examine the name of RFiles recently created in your system. If you have one or
more padded 0 characters (after an initial letter), as in I000zy98.rf or
I0123abc.rf, you are probably at low risk from this bug.</p>

<p>This issue was fixed in pull request <a href="https://github.com/apache/accumulo/issues/562">#562</a></p>

<h3 id="updated-master-metrics-to-include-fate-metrics">Updated Master Metrics to include FATE metrics.</h3>

<p>Added master metrics to provide a snapshot of current FATE operations.  The metrics added:</p>
<ul>
  <li>the number of current FATE transactions in progress,</li>
  <li>the count of child operations that have occurred on the zookeeper FATE node</li>
  <li>a count of zookeeper connection errors when the snapshot is taken.</li>
</ul>

<p>The number of child operations provides a light-weight surrogate for FATE transaction 
progression between snapshots. The metrics are controlled with the following properties:</p>

<ul>
  <li>master.fate.metrics.enabled - default to <em>false</em> preserve current metric reporting</li>
  <li>master.fate.metrics.min.update.interval - default to <em>60s</em> - there is a hard limit of 10s.</li>
</ul>

<p>When enabled, the metrics are published to JMX and can optionally be configured using standard 
hadoop metrics2 configuration files.</p>

<h3 id="fixed-issues-with-native-maps-with-libstdc-82-and-higher">Fixed issues with Native Maps with libstdc++ 8.2 and higher</h3>

<p>Versions of libstdc++ 8.2 and higher triggered errors within within the native map code. 
This release fixes issues <a href="https://github.com/apache/accumulo/issues/767">#767</a>, <a href="https://github.com/apache/accumulo/issues/769">#769</a> and …</p>

<h3 id="fixed-splitting-tablets-with-files-and-no-data">Fixed splitting tablets with files and no data</h3>

<p>The split code assumed that if a tablet had files that it had data in
those files.  There are some edge case where this is not true.  Updated
the split code to handle this <a href="https://github.com/apache/accumulo/issues/999">#998</a>.</p>

<h3 id="log-when-a-scan-waits-a-long-time-for-files">Log when a scan waits a long time for files.</h3>

<p>Accumulo has a configurable limit on the max number of files open in a
tserver for all scans.  When too many files are open, scans must wait.
In <a href="https://github.com/apache/accumulo/issues/978">#978</a> and <a href="https://github.com/apache/accumulo/issues/981">#981</a> scans that wait too long for files now log a message.</p>

<h3 id="fixed-race-condition-in-table-existence-check">Fixed race condition in table existence check.</h3>

<p>The Accumulo client code that checks if tables exists had a race 
condition.  The race was fixed in <a href="https://github.com/apache/accumulo/issues/768">#768</a> and <a href="https://github.com/apache/accumulo/issues/973">#973</a></p>

<h3 id="support-running-mini-accumulo-using-java-11">Support running Mini Accumulo using Java 11</h3>

<p>Mini Accumulo made some assumptions about classloaders that were no 
longer true in Java 11.  This caused Mini to fail in Java 11.  In 
<a href="https://github.com/apache/accumulo/issues/924">#924</a> Mini was updated to work with Java 11, while still working
with Java 7 and 8.</p>

<h3 id="fixed-issue-with-improperly-configured-snappy">Fixed issue with improperly configured Snappy</h3>

<p>If snappy was configured for a table and the snappy libraries were not 
available on the system then this could cause minor compactions to hang
forever.  In <a href="https://github.com/apache/accumulo/issues/920">#920</a> and <a href="https://github.com/apache/accumulo/issues/925">#925</a> this was fixed and minor 
compactions will proceed when a different compression is configured.</p>

<h3 id="handle-bad-locality-group-config">Handle bad locality group config.</h3>

<p>Improperly configured locality groups could cause a tablet to become
inoperative.  This was fixed in <a href="https://github.com/apache/accumulo/issues/819">#819</a> and <a href="https://github.com/apache/accumulo/issues/840">#840</a>.</p>

<h3 id="fixed-bulk-import-race-condition">Fixed bulk import race condition.</h3>

<p>There was a race condition in bulk import that could result in files
being imported after a bulk import transaction had completed.  In the
worst case these files were already compacted and garbage collected. 
This would cause a tablet to have a reference to a file that did not 
exists.  No data would have been lost, but it would cause scans to fail.
The race was fixed in <a href="https://github.com/apache/accumulo/issues/800">#800</a> and <a href="https://github.com/apache/accumulo/issues/837">#837</a></p>

<h3 id="fixed-issue-with-hostregextableloadbalancer">Fixed issue with HostRegexTableLoadBalancer</h3>

<p>This addresses an issue when using the HostRegexTableLoadBalancer 
when the default pool is empty. The load balancer will not assign the tablets at all. 
Here, we select a random pool to assign the tablets to. This behavior is on by 
default in the HostRegexTableLoadBalancer but can be disabled via 
HostRegexTableLoadBalancer configuration setting
 <em>table.custom.balancer.host.regex.HostTableLoadBalancer.ALL</em><br />
 Fixed in <a href="https://github.com/apache/accumulo/issues/691">#691</a> - backported to 1.9 in <a href="https://github.com/apache/accumulo/issues/710">#710</a></p>

<h3 id="update-to-libthrift-version">Update to libthrift version</h3>

<p>The packaged, binary  tarball contains updated version of libthrift to version 0.9.3-1 to
address thrift CVE. Issue <a href="https://github.com/apache/accumulo/issues/1029">#1029</a></p>

<h2 id="useful-links">Useful links</h2>

<ul>
  <li><a href="https://github.com/apache/accumulo/compare/rel/1.9.2...apache:rel/1.9.3">All Changes since 1.9.2</a></li>
  <li><a href="https://github.com/apache/accumulo/issues?q=label%3Av1.9.3">GitHub</a> - List of issues tracked on GitHub corresponding to this release</li>
  <li><a href="/release/accumulo-1.9.2/">1.9.2 release notes</a> - Release notes showing changes in the previous release</li>
</ul>

<h2 id="upgrading">Upgrading</h2>

<p>View the <a href="/docs/2.x/administration/upgrading">Upgrading Accumulo documentation</a> for guidance.</p>

<h2 id="testing-todo">Testing TODO</h2>

<ul>
  <li>(Example) All ITs passed with Hadoop 3.0.0 (hadoop.profile=3)</li>
  <li>(Example) All ITs passed with Hadoop 2.6.4 (hadoop.profile=2)</li>
  <li>(Example) Ran 3 continuous ingesters successfully for 24 hours on a 10 node cluster
with agitation and pausing. Verification for all 3 tests was successful.</li>
  <li>(Example) Ran continuous ingest for 24 hours and verified without agitation on a 10
node cluster.</li>
  <li>(Example) Tested <a href="https://fluo.apache.org">Apache Fluo</a> build and ITs passed against this version.</li>
  <li>(Example) Ran a single-node cluster with <a href="https://github.com/apache/fluo-uno">Uno</a> and created a table, ingested data,
flushed, compacted, scanned, and deleted the table.</li>
</ul>



<p><strong>View all releases in the <a href="/release/">archive</a></strong></p>

        </div>

        
<footer>

  <p><a href="https://www.apache.org/foundation/contributing"><img src="https://www.apache.org/images/SupportApache-small.png" alt="Support the ASF" id="asf-logo" height="100" /></a></p>

  <p>Copyright © 2011-2019 <a href="https://www.apache.org">The Apache Software Foundation</a>.
Licensed under the <a href="https://www.apache.org/licenses/">Apache License, Version 2.0</a>.</p>

  <p>Apache®, the names of Apache projects and their logos, and the multicolor feather
logo are registered trademarks or trademarks of The Apache Software Foundation
in the United States and/or other countries.</p>

</footer>


      </div>
    </div>
  </div>
</body>
</html>
